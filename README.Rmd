---
output: 
  github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
# copy and paste this next to '# ukbwranglr' below to include hex badge
# <img src="man/figures/test.png" align="right" width="100" />
```

# ukbwranglr

<!-- badges: start -->

[![R build status](https://github.com/rmgpanw/ukbwranglr/workflows/R-CMD-check/badge.svg)](https://github.com/rmgpanw/ukbwranglr/actions) [![Codecov test coverage](https://codecov.io/gh/rmgpanw/ukbwranglr/branch/main/graph/badge.svg)](https://codecov.io/gh/rmgpanw/ukbwranglr?branch=main) [![pkgdown](https://github.com/rmgpanw/ukbwranglr/workflows/pkgdown/badge.svg)](https://github.com/rmgpanw/codemapper/actions) [![Launch RStudio Cloud](https://img.shields.io/badge/RStudio-Cloud-blue)](https://rstudio.cloud/project/2528744) [![Project Status: WIP â€“ Initial development is in progress, but there has not yet been a stable, usable release suitable for the public.](https://www.repostatus.org/badges/latest/wip.svg)](https://www.repostatus.org/#wip)

<!-- badges: end -->

***--UNDER CONSTRUCTION--***

# Overview

The goal of `ukbwranglr` is to facilitate analysing UK Biobank data. This includes:

1. Reading selected UK Biobank variables into R
2. Summarising continuous variables
3. Identifying phenotypic outcomes from clinical events data (e.g. self-reported medical conditions and linked health records data)

# Reading a selection of variables into R

A UK Biobank main dataset file is typically too large to fit into memory on a personal computer. Often however, only a subset of the data is required.

*Raw data appearance:*

```{r}
library(dplyr)
library(ukbwranglr)

# path to dummy data
DUMMY_DATA_PATH <- system.file("extdata", "dummy_ukb_data.csv", package = "ukbwranglr")

# appearance of raw data
data.table::fread(DUMMY_DATA_PATH) %>% 
  select(eid, 
         `31-0.0`, 
         `34-0.0`,
         `21000-0.0`, 
         `20002-0.0`, 
         `21001-0.0`) %>% 
  head(n = 5)
```

*Appearance when loaded using `ukbwranglr::read_ukb()`:*

```{r}
data_dict <- ukbwranglr::make_data_dict(DUMMY_DATA_PATH, delim = ",")
ukbwranglr::read_ukb(DUMMY_DATA_PATH, data_dict, delim = ",") %>% 
  labelled::unlabelled() %>% 
  head()
```

`ukbwranglr` can also help to:

-   Identify participants with certain health conditions or taking certain medications (with dates)
-   Summarise biomarker measurements (e.g. extract the mean systolic blood pressure across repeated measurements)

Please see ['getting started'](https://rmgpanw.github.io/ukbwranglr/articles/ukbwranglr.html) on the [package documentation website](https://rmgpanw.github.io/ukbwranglr/index.html) for further details.

## Installation

You can install the development version of `ukbwranglr` with:

```{r eval=FALSE}
# install.packages("devtools")
devtools::install_github("rmgpanw/ukbwranglr")
```

## Basic usage - reading selected columns from a UK Biobank dataset into R

**Steps:**

1.  Create a data dictionary specific to your UK Biobank file
2.  Filter this for your required variables
3.  Read your selected columns into R

This process is outlined below for dummy UK Biobank data generated using the [tofu library](https://github.com/spiros/tofu) (*Spiros Denaxas. (2020). spiros/tofu: Updated release for DOI (Version v1.1). Zenodo. http://doi.org/10.5281/zenodo.3634604*).

#### 1. Create data dictionary

```{r eval=FALSE}
# load package
library(ukbwranglr)

# make data dictionary
data_dict <- make_data_dict("MY_UKB_FILE.tab")
```

#### 2. Filter data dictionary for required variables

```{r eval=FALSE}
# Filter for sex, year of birth, BMI and self-reported noncancer-illness fields
data_dict <- data_dict %>%
  dplyr::filter(FieldID %in% c("31",
                               "34",
                               "21001",
                               "20002"))
```

#### 3. Read selected columns into R

```{re val=FALSE}
read_ukb(path = "MY_UKB_FILE.tab", 
                        pheno_data_dict = data_dict)
```
